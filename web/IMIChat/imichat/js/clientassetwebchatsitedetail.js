var lc_website_id,lc_rtm_id,r,g,b,hue,saturation,lightness,_survey_fields=[],color="#00b0f0",_cond_check_snippet='<a href="#" class="check"><i class="fa fa-check"></i></a>',_is_edit=!1,_field_row_snippet='<tr data-id="{0}">{1}</tr>',_field_body_snippet='<td><i class="qualification-feildtype-{0}"></i></td><td>{1}</td><td>{2}</td><td><a class="edit" data-link-type="edit" data-id="{3}" onclick="livechatWSsettings.openSurveyFieldModal({3})"><i class="fa fa-pencil" title="Edit"></i></a><a class="delete" data-link-type="delete" data-id="{3}" onclick="livechatWSsettings.deleteSurveyField({3})"><i class="fa fa-trash" title="Delete"></i></a></td>',_option_snippet='<option value="{0}">{1}</option>',_dropdown_choice_snippet='<div class="col-xs-12 nopad" data-id="{0}"><div class="col-xs-6 nopad"><div class="form-group is-empty"><input type="text" id="txtDropdownChoice{0}" data-id="{0}" class="form-control wms-val-alphanumericwithspace" maxlength="30" value="{1}" ></div></div><div data-button-type="remove" class="col-xs-1 padleft_0 padright padtop_5 text-right"><a href="#" class="text-center" onclick="livechatWSsettings.deleteSurveyFieldOption({0}, this)"><i class="fa fa-trash"></i></a></div><div data-button-type="add" class="col-xs-1 padright_0 padtop_5"><a href="#" class="text-center" onclick="livechatWSsettings.addDropdownChoice()"><i class="fa fa-plus"></i></a></div></div>',_survey_previw_text_snippet=' <div class="feild-div"><span class="supporttxt-abovetxtbox">{0}{1}</span><input type="text" class="form-feild"><span class="input-group-btn"><button class="btn btn-togo" type="button"><i class="icon-send-button"></i></button></span><div class="clearfix"></div></div>',_survey_previw_dropdown_snippet=' <div class="feild-div"><span class="supporttxt-abovetxtbox">{0}{2}</span><select class="form-feild"><option>--Select--</option>{1}</select><span class="input-group-btn"><button class="btn btn-togo" type="button"><i class="icon-send-button"></i></button></span><div class="clearfix"></div></div>',_client_field_id=0,_cleint_field_option_id=0,_current_field_id=0,livechatWSsettings={bindWebSiteData:function(e){""!=e?($("#1,#2,#3").removeClass("disabled"),$("#divWidgetColor").colorpicker({format:"hex"}),$("#txtwebsitename").val(e.name),$("#txtbylinetxt").val(e.bylinetext),$("#spnwebsitename").text(e.name),$("#spnbylinetext").text(e.bylinetext),$("#txtbaseurl").val(e.host),$("#chkwaittime").prop("checked",e.wt_type_enabled),1==e.wt_type_enabled?$("#chkwaittime").val("1"):$("#chkwaittime").val("0"),$("input[name=setwaittime][value="+e.wt_type+"]").prop("checked",!0),$("input[name=switch_3][value="+e.button_shape+"]").prop("checked",!0),$("#chkenableemoji").prop("checked",e.isemojienable),$("#chkenableemoji").is(":checked")?$(".icon-happy").css("display","block"):$(".icon-happy").css("display","none"),$("#divWidgetColor").colorpicker("setValue",e.widgetcolor),$("#divWidgetColor").colorpicker({format:"hex"}),null!=e.logo_path&&""!=e.logo_path&&void 0!=e.logo_path||(e.logo_path="imichat/images/default-logo.png"),$(".imiwidget-clientlogo").attr("src",e.logo_path)):($(".imiwidget-clientlogo").attr("src","imichat/images/default-logo.png"),$("#divWidgetColor").colorpicker({format:"hex"})),_survey_fields=e.SurveyFields,livechatWSsettings.bindCustomerQualificationData(_survey_fields),livechatWSsettings.bindWidgetVisibility(e.VisibleHours,e.BlacklistedIPs),color=e.widgetcolor,livechatWSsettings.ChangeWidgetPreviewColors(e.widgetcolor)},validateSessionData:function(){return void 0==sessionStorage.getItem("LCRTMID")||null==sessionStorage.getItem("LCRTMID")||""==sessionStorage.getItem("LCRTMID")?(UIToastr("error","something went wrong please refresh the page and tryagain..."),!1):void 0!=sessionStorage.getItem("LCWSID")&&null!=sessionStorage.getItem("LCWSID")&&""!=sessionStorage.getItem("LCWSID")||"1"!=sessionStorage.getItem("LCISEDIT")?(void 0!=sessionStorage.getItem("LCWSID")&&null!=sessionStorage.getItem("LCWSID")&&""!=sessionStorage.getItem("LCWSID")||$("#1,#2,#3").addClass("disabled"),!0):(UIToastr("error","something went wrong please refresh the page and tryagain..."),!1)},saveWsGeneralSettings:function(e){if(e.indexOf("Error")>=0||e.indexOf("ERROR")>=0){var t=e.substring(6);"2"==t?UIToastr("error","A website with name: "+$("#txtwebsitename").val()+" already exists"):"3"==t?UIToastr("error","A website with Domain Name: "+$("#txtbaseurl").val()+" already exists"):UIToastr("error","something went wrong please refresh the page and tryagain")}if(e.indexOf("success")>=0||e.indexOf("SUCCESS")>=0)return"0"!=(e=e.substring(8).split("|"))[0]&&"1"!=e[0]||UIToastr("success","General settings saved successfully"),sessionStorage.setItem("LCWSID",e[1]),sessionStorage.setItem("LCISEDIT",1),lc_website_id=e[1],$("#1,#2,#3").removeClass("disabled"),$("#divWidgetColor").colorpicker("setValue","#03a9f4"),$("#divWidgetColor").colorpicker({format:"hex"}),void livechatWSsettings.bindCustomerQualificationData(_survey_fields)},saveWsAppearenceSettings:function(e){if(e.indexOf("Error")>=0||e.indexOf("ERROR")>=0){e.substring(6);UIToastr("error","unable to update the Appearance settings")}else{if(e.indexOf("success")>=0||e.indexOf("SUCCESS")>=0)"0"!=(e=e.substring(8))&&"1"!=e||UIToastr("success","Appearance settings saved successfully");else;}},bindSurveyWidgetPreview:function(){var e=livechatWSsettings.findFirstSurveyFieldIndex();$.each(_survey_fields,function(e,t){t.processed=!1});var t="";$.each(_survey_fields,function(i,a){a.status<1||!a.processed&&i>=e&&(t+=livechatWSsettings.preparePreviewSnippet(a))}),$("#liSurveyFields").html(t),livechatWSsettings.ChangeWidgetPreviewColors(color),$("#dvChatSurvey").toggle(_survey_fields.some(function(e){return e.status>0}))},preparePreviewSnippet:function(e){_survey_fields.some(function(t){return t.cond_field_id===e.id});var t="";if(e.field_type>1)t=_survey_previw_text_snippet.format(e.name,e.is_mandatory?"<span>*</span>":"");else{var i="";$.each(e.options,function(e,t){i+=_option_snippet.format(t.id,t.name)}),t=_survey_previw_dropdown_snippet.format(e.name,i,e.is_mandatory?"<span>*</span>":"")}if(e.processed=!0,null!==e.cond_field_id){var a=_survey_fields.filter(function(t){return t.id===e.cond_field_id})[0];t+=livechatWSsettings.preparePreviewSnippet(a)}return t},bindSurveyFieldGrid:function(){var e=livechatWSsettings.findFirstSurveyFieldIndex();$.each(_survey_fields,function(e,t){t.processed=!1}),grid_snippet="",$.each(_survey_fields,function(t,i){!i.processed&&i.status>0&&t>=e&&(grid_snippet+=livechatWSsettings.prepareGridRowSnippet(i))}),$("#tblFields tbody").html(grid_snippet)},findFirstSurveyFieldIndex:function(){var e=_survey_fields.length-1;return $.each(_survey_fields,function(e,t){t.processed=!1}),$.each(_survey_fields,function(t,i){if(!i.processed&&i.status>0){var a=livechatWSsettings.loopThroughSurveyFields(i,t);a<e&&(e=a)}}),e},loopThroughSurveyFields:function(e,t){var i=t,a=_survey_fields.filter(function(t,a){return t.status>0&&t.cond_field_id==e.id&&(i=a,t.processed=!0,!0)})[0];return void 0!==a?livechatWSsettings.loopThroughSurveyFields(a,i):t},prepareGridRowSnippet:function(e){var t=_survey_fields.some(function(t){return t.cond_field_id===e.id}),i=_field_row_snippet.format(e.id,_field_body_snippet.format(e.field_type,e.name,t?_cond_check_snippet:"",e.id));if(e.processed=!0,null!==e.cond_field_id){var a=_survey_fields.filter(function(t){return t.id===e.cond_field_id})[0];i+=livechatWSsettings.prepareGridRowSnippet(a)}return i},bindCustomerQualificationData:function(e){livechatWSsettings.bindSurveyFieldGrid(),$("#btnAddField").click(function(){_is_edit=!1,_current_field_id=0,livechatWSsettings.clearCustomerQualificationModal(),livechatWSsettings.bindSurveyField(),$("#myappcustommodule").modal("show"),$("#txtFieldName").focus()}),$("#btnSaveField").click(function(){void 0!==livechatWSsettings.saveSurveyField()&&(livechatWSsettings.bindSurveyFieldGrid(),$("#myappcustommodule").modal("hide"))}),$("#ddlFieldType").change(function(){var e=parseInt($(this).val());$("#dvChoices").toggle(1==e),$("#ddlPropertyType").prop("disabled",7===e),$('#ddlPropertyType option[value="true"]').prop("selected",!0)}),$("#chkIsConditional").click(function(){$("#dvConditional").toggle($(this).prop("checked"))}),$("#btnSaveFields").click(function(){livechatWSsettings.saveSurveyFields()}),$("#ddlFieldCollection").change(function(){var e=livechatWSsettings.getSurveyField(parseInt($(this).val()));$('#ddlFieldOperator option[value="1"]').prop("selected",!0),livechatWSsettings.bindParentFieldInfo(e),livechatWSsettings.validateCondValueField(e.field_type)}),livechatWSsettings.bindSurveyWidgetPreview()},deleteSurveyFieldOption:function(e,t){var i=livechatWSsettings.getSurveyField(_current_field_id);void 0!==i&&(i.options=i.options.filter(function(t){return t.id!==e||e>0&&(t.status=0,!0)})),$('#dvChoices div[data-id="{0}"]'.format(e)).remove(),livechatWSsettings.manageChoiceRemoveVisibility()},addDropdownChoice:function(){$("#dvChoices div:first").append(_dropdown_choice_snippet.format(--_cleint_field_option_id,"")),$("#dvChoices input:text").filter(function(){return""===$(this).val()})[0].focus(),livechatWSsettings.manageChoiceRemoveVisibility()},manageChoiceRemoveVisibility:function(){$('#dvChoices div[data-button-type="remove"]').toggle($("#dvChoices div[data-id]").length>1),$('#dvChoices div[data-button-type="add"]').not(":last").hide(),$('#dvChoices div[data-button-type="add"]:last').show()},openSurveyFieldModal:function(e){_is_edit=!0,_current_field_id=e,livechatWSsettings.bindSurveyField(e),$("#myappcustommodule").modal("show")},deleteSurveyField:function(e){var t=livechatWSsettings.getSurveyField(e);if(null===t.cond_field_id){t.status=0,t.update=!0;var i=_survey_fields.filter(function(e){return e.cond_field_id===t.id})[0];void 0!==i&&(i.update=!0,i.cond_field_id=null,i.operator=null,i.value=null),$('#tblFields tbody tr[data-id="{0}"]'.format(e)).remove(),livechatWSsettings.bindSurveyWidgetPreview()}else UIToastr("error","Field can't be deleted as it is referenced by other field.")},validateSurveyField:function(){var e=0;0==$("#txtFieldName").val().trim().length?(wmsutil.showToolTip("#txtFieldName","Please provide field name","top"),e++):_survey_fields.some(function(e){return e.id!==_current_field_id&&e.status>0&&e.name.trim().toLowerCase()===$("#txtFieldName").val().trim().toLowerCase()})?(wmsutil.showToolTip("#txtFieldName","Field name already exists. Please use another name","top"),e++):wmsutil.destroyToolTip("#txtFieldName");_survey_fields.some(function(e){return e.id!==_current_field_id&&e.status>0&&[7].indexOf(parseInt($("#ddlFieldType option:selected").val()))>=0&&e.field_type===parseInt($("#ddlFieldType option:selected").val())})?(wmsutil.showToolTip("#ddlFieldType","Profile name type already exists. Please use another type","top"),e++):(wmsutil.destroyToolTip("#ddlFieldType"),_survey_fields.some(function(e){return e.id!==_current_field_id&&e.status>0&&[3].indexOf(parseInt($("#ddlFieldType option:selected").val()))>=0&&e.field_type===parseInt($("#ddlFieldType option:selected").val())&&1==e.is_profile_type&&e.is_profile_type==JSON.parse($("#ddlPropertyType option:selected").val())})?(wmsutil.showToolTip("#ddlFieldType","Email profile type already exists. Please use another type","top"),e++):wmsutil.destroyToolTip("#ddlFieldType"));if(1===parseInt($("#ddlFieldType option:selected").val())&&$('#dvChoices div:first input[type="text"]').each(function(){0==$(this).val().trim().length&&(wmsutil.showToolTip("#{0}".format($(this).attr("id")),"Please provide choice","top"),e++)}),$("#chkIsConditional").prop("checked")){var t=livechatWSsettings.getSurveyField(parseInt($("#ddlFieldCollection option:selected").val()));t.field_type>1&&0==$("#fieldValue").val().trim().length&&(wmsutil.showToolTip("#fieldValue","Please provide value","top"),e++),3===t.field_type&&(validateEmail($("#fieldValue").val().trim())||(wmsutil.showToolTip("#fieldValue","Please provide valid email id","top"),e++))}return 0===e},saveSurveyField:function(){if(livechatWSsettings.validateSurveyField()){var e=livechatWSsettings.getSurveyField(_current_field_id);void 0===e&&(e={id:--_client_field_id,website_id:lc_website_id,status:1,cond_field_id:null,operator:null,value:null},_survey_fields.push(e)),e.update=!0,e.name=$("#txtFieldName").val(),e.field_type=parseInt($("#ddlFieldType option:selected").val()),e.is_profile_type=JSON.parse($("#ddlPropertyType option:selected").val()),e.options=void 0!==e.options?e.options:[],e.field_type>1&&e.options.length>0&&(e.options=e.options.filter(function(e){return e.id>0&&(e.status=0,!0)})),1===e.field_type&&$('#dvChoices div input[type="text"]').each(function(t){var i=$(this),a=e.options.filter(function(e){return e.id===parseInt(i.attr("data-id"))})[0];void 0===a&&(a={id:--_cleint_field_option_id,status:1},e.options.push(a)),a.name=a.value=i.val()}),e.is_mandatory=$("#chkIsMandatory").prop("checked"),e.description=$("#txtFieldDescription").val();var t=parseInt($("#ddlFieldCollection option:selected").val());if(NaN!==t){var i=livechatWSsettings.getSurveyField(t);$("#chkIsConditional").prop("checked")?(i.cond_field_id=e.id,i.operator=$("#ddlFieldOperator option:selected").val(),i.value=i.field_type>1?$("#fieldValue").val():$("#fieldValue option:selected").val(),i.update=!0):void 0!==i&&(i.update=!0,i.cond_field_id=null,i.operator=null,i.value=null)}return livechatWSsettings.bindSurveyWidgetPreview(),e}},saveSurveyFields:function(){_survey_fields=_survey_fields.filter(function(e){return e.id>0||1===e.status&&e.id<=0}),wsSettings.updateWebsitePrechatSurvey(lc_rtm_id,_survey_fields.filter(function(e){return!0===e.update}),function(e){$.each(e,function(e,t){var i=livechatWSsettings.getSurveyField(t.field.id);if(i.update=!1,t.field.db_id>0){$('#tblFields tbody a[data-id="{0}"][data-link-type="edit"]'.format(i.id)).attr("onclick","livechatWSsettings.openSurveyFieldModal({0})".format(t.field.db_id)),$('#tblFields tbody a[data-id="{0}"][data-link-type="delete"]'.format(i.id)).attr("onclick","livechatWSsettings.deleteSurveyField({0})".format(t.field.db_id)),$('#tblFields tbody tr[data-id="{0}"]'.format(i.id)).attr("data-id",t.field.db_id),$('#tblFields tbody a[data-id="{0}"]'.format(i.id)).attr("data-id",t.field.db_id);var a=_survey_fields.filter(function(e){return e.cond_field_id===i.id})[0];i.id=t.field.db_id,void 0!==a&&(a.cond_field_id=t.field.db_id)}$.each(t.field_options,function(e,t){var a=i.options.filter(function(e){return e.id===t.id})[0];t.db_id>0&&(a.id=t.db_id)})}),_survey_fields=_survey_fields.filter(function(e){return e.status>0}),UIToastr("success","Data updated successfully.")})},getSurveyField:function(e){return _survey_fields.filter(function(t,i){return t.id===e})[0]},bindSurveyField:function(e){wmsutil.destroyToolTip("#txtFieldName"),wmsutil.destroyToolTip("#ddlPropertyType");var t=livechatWSsettings.getSurveyField(e),i=_survey_fields.filter(function(e,i){return void 0!==t&&e.cond_field_id===t.id})[0];if(void 0===e?($("#hdrCustomFieldModal").text("Add New Custom Field"),$("#btnSaveField").text("ADD")):($("#hdrCustomFieldModal").text("Update Custom Field"),$("#btnSaveField").text("UPDATE")),$("#ddlFieldCollection").html(""),$.each(_survey_fields,function(i,a){null!==a.cond_field_id||1!==a.status||a.id===e||void 0!==t&&null!==t.cond_field_id&&t.cond_field_id===a.id||$("#ddlFieldCollection").append(_option_snippet.format(a.id,a.name))}),$("#ddlPropertyType").prop("disabled",7===parseInt($("#ddlFieldType option:selected").val())),void 0!==i&&($("#ddlFieldCollection").prepend(_option_snippet.format(i.id,i.name)),$('#ddlFieldCollection option[value="{0}"]'.format(i.id)).prop("selected",!0),livechatWSsettings.bindParentFieldInfo(i)),$("#ddlFieldCollection option").length>0){if(void 0===i){var a=livechatWSsettings.getSurveyField(parseInt($("#ddlFieldCollection option:selected").val()));livechatWSsettings.bindParentFieldInfo(a)}$("#chkIsConditional").hasClass("disable")&&($("#chkIsConditional").removeClass("disable"),$("#chkIsConditional").removeAttr("disabled"))}else $("#chkIsConditional").hasClass("disable")||($("#chkIsConditional").addClass("disable"),$("#chkIsConditional").attr("disabled","disabled"));if($("#dvChoices div:first").html(_dropdown_choice_snippet.format(--_cleint_field_option_id,"")),livechatWSsettings.manageChoiceRemoveVisibility(),void 0!==t){if($("#txtFieldName").val(t.name),$('#ddlFieldType option[value="{0}"]'.format(t.field_type)).prop("selected",!0),$('#ddlPropertyType option[value="{0}"]'.format(t.is_profile_type)).prop("selected",!0),$("#dvChoices").toggle(1===t.field_type),1===t.field_type){var l="";$.each(t.options,function(e,t){1===t.status&&(l+=_dropdown_choice_snippet.format(t.id,t.name))}),$("#dvChoices div:first").html(l),livechatWSsettings.manageChoiceRemoveVisibility()}$("#chkIsMandatory").prop("checked",t.is_mandatory),$("#txtFieldDescription").val(t.description),$("#chkIsConditional").prop("checked",void 0!==i),$("#dvConditional").toggle(void 0!==i)}},bindParentFieldInfo:function(e,t){var i="";if($("#ddlFieldOperator option:gt(1)").toggle([1,2,3,7].indexOf(e.field_type)<0),void 0!==e.operator&&null!==e.operator&&$('#ddlFieldOperator option[value="{0}"]'.format(e.operator)).prop("selected",!0),e.field_type>1)i='<input id="fieldValue" class="form-control wms-val-alphanumericwithspace" maxlength={0} type="text">',i=[4,5].indexOf(e.field_type)>=0?i.format(5):i.format(30),$("#dvFieldValue").html(i),6===e.field_type?($("#fieldValue").prop("readonly",!0),$("#fieldValue").datepicker({format:"M/dd/yyyy",pickTime:!1,autoclose:!0}),void 0!==e.value&&null!==e.value&&""!==e.value&&$("#fieldValue").datepicker("update",e.value)):void 0!==e.value&&null!==e.value&&$("#fieldValue").val(e.value),livechatWSsettings.validateCondValueField(e.field_type);else{var a="";$.each(e.options,function(e,t){a+=_option_snippet.format(t.value,t.name)}),i='<select id="fieldValue">{0}</select>'.format(a),$("#dvFieldValue").html(i),void 0!==e.value&&null!==e.value&&$('#fieldValue option[value="{0}"]'.format(e.value)).prop("selected",!0)}},validateCondValueField:function(e){switch(e){case 2:$("#fieldValue").on("keyup blur",function(e){this.value.match(/[^0-9a-zA-Z ]/g)&&(this.value=this.value.replace(/[^0-9a-zA-Z ]/g,""))});break;case 4:case 5:$("#fieldValue").keypress(function(t){return IMIchat_Util.isReal(t,this,4===e)})}},clearCustomerQualificationModal:function(){$("#txtFieldName").val(""),$('#ddlFieldType option[value="1"]').prop("selected",!0),$("#dvChoices").toggle(!0),$("#chkIsMandatory").prop("checked",!1),$("#txtFieldDescription").val(""),$("#chkIsConditional").prop("checked",!1),$("#dvConditional").toggle(!1),$("#ddlFieldCollection").html(""),$("#dvFieldValue").html(""),$('#ddlFieldOperator option[value="1"]').prop("selected",!0)},rgbToHsl:function(e,t,i){e/=255,t/=255,i/=255;var a,l,s=Math.max(e,t,i),n=Math.min(e,t,i),o=(s+n)/2;if(s==n)a=l=0;else{var d=s-n;switch(l=o>.5?d/(2-s-n):d/(s+n),s){case e:a=(t-i)/d+(t<i?6:0);break;case t:a=(i-e)/d+2;break;case i:a=(e-t)/d+4}a/=6}return[a,l,o]},LogoUpload:function(){var e=$("#txtHdnWorkspaceId").val();$("#fLogoUpload").fileupload({replaceFileInput:!1,dataType:"json",type:"POST",headers:{SESSTOKEN:$("#sesstoken").val(),RTN:wmsutil.getGUID()},url:$("#baseurl").val()+"Handlers/FileUpload.ashx?action=uploadlcwslogo&ws="+e,beforeSend:function(e,t){e.setRequestHeader("RTN",wmsutil.getGUID())},add:function(e,t){var i=!0,a=/^.+\.((jpg)|(png)|(jpeg))$/i;$.each(t.files,function(e,t){a.test(t.name)||(UIToastr("error","You have uploaded an invalid file type. Accepted file formats are: .jpg, .jpeg and .png"),i=!1)}),i&&$.each(t.files,function(e,t){t.size>2e5&&(UIToastr("error","Image size should be less than or equal to 200KB only"),i=!1)}),i&&t.submit()},done:function(e,t){$(".imiwidget-clientlogo").attr("src",t.result),$("#hdnlogo").val("1"),$("#icon-close-icon-logo").show(),$("#fileUpload-logo-filename").html($(this).val().replace(/C:\\fakepath\\/i,"")),$(this).val("")},processfail:function(e,t){UIToastr("error","Error in processing,please refresh the page and tryagain."),$(this).val("")},error:function(e,t){""!=e.responseText?(UIToastr("error","Invalid Image Dimension"),$(this).val("")):(UIToastr("error","Error in processing."),$(this).val(""))}})},deletelogo:function(){$("#hdnlogo").val("0"),$("#icon-close-icon-logo").hide(),$(".imiwidget-clientlogo").attr("src","imichat/images/default-logo.png"),$("#fileUpload-logo-filename").html("logo file name")},SaveOfficeTimingsSettings:function(e){try{var t=!0;$("input[name=dayeach_0]").is(":checked")&&(this.validateTime($("[name='sttime_0']").val().trim(),$("[name='entime_0']").val().trim())||(wmsutil.showToolTip('[name="entime_0"]',"Please select end time greater than start time","bottom"),t=!1)),$("input[name=dayeach_1]").is(":checked")&&(this.validateTime($("[name='sttime_1']").val().trim(),$("[name='entime_1']").val().trim())||(wmsutil.showToolTip('[name="entime_1"]',"Please select end time greater than start time","bottom"),t=!1)),$("input[name=dayeach_2]").is(":checked")&&(this.validateTime($("[name='sttime_2']").val().trim(),$("[name='entime_2']").val().trim())||(wmsutil.showToolTip('[name="entime_2"]',"Please select end time greater than start time","bottom"),t=!1)),$("input[name=dayeach_3]").is(":checked")&&(this.validateTime($("[name='sttime_3']").val().trim(),$("[name='entime_3']").val().trim())||(wmsutil.showToolTip('[name="entime_3"]',"Please select end time greater than start time","bottom"),t=!1)),$("input[name=dayeach_4]").is(":checked")&&(this.validateTime($("[name='sttime_4']").val().trim(),$("[name='entime_4']").val().trim())||(wmsutil.showToolTip('[name="entime_4"]',"Please select end time greater than start time","bottom"),t=!1)),$("input[name=dayeach_5]").is(":checked")&&(this.validateTime($("[name='sttime_5']").val().trim(),$("[name='entime_5']").val().trim())||(wmsutil.showToolTip('[name="entime_5"]',"Please select end time greater than start time","bottom"),t=!1)),$("input[name=dayeach_6]").is(":checked")&&(this.validateTime($("[name='sttime_6']").val().trim(),$("[name='entime_6']").val().trim())||(wmsutil.showToolTip('[name="entime_6"]',"Please select end time greater than start time","bottom"),t=!1))}catch(e){}return t},validateTime:function(e,t){try{var i=new Date("1/1/2015 "+e+":00");return!(new Date("1/1/2015 "+t+":00")-i<=0)}catch(e){return!1}},validateWsGeneralSettings:function(){var e=!0;""==$("#txtwebsitename").val()&&(wmsutil.showToolTip("#txtwebsitename","Please provide Website Name before publishing changes","top"),e=!1),$("#txtwebsitename").val().length>30&&(wmsutil.showToolTip("#txtwebsitename","Website Name supports a maximum of 30 characters","top"),e=!1),$("#txtbylinetxt").val().length>100&&(wmsutil.showToolTip("#txtbylinetxt","Byline Text supports a maximum of 100 characters","top"),e=!1),""==$("#txtbaseurl").val()&&(wmsutil.showToolTip("#txtbaseurl","Please provide Domain name before publishing changes","top"),e=!1),$("#txtbaseurl").val().length>100&&(wmsutil.showToolTip("#txtbaseurl","Domain name supports a maximum of 100 characters","top"),e=!1);return/^([*)+([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,6}$/.test($("#txtbaseurl").val())||(wmsutil.showToolTip("#txtbaseurl","Please provide Valid Domain name before publishing changes","top"),e=!1),e},bindWidgetVisibility:function(e,t){try{if(null!=e)for(var i=0;i<e.length;i++){"1"==e[i].status?$("[name='dayeach_"+e[i].weekday+"']").prop("checked",!0):$("[name='dayeach_"+e[i].weekday+"']").prop("checked",!1),$(".workingday:checked").length==$(".workingday").length&&$("#chkselectall").prop("checked",!0);var a=e[i].starttime;a=a.split(":");var l=e[i].endtime;l=l.split(":"),$("[name='sttime_"+e[i].weekday+"']").val(a[0]+":"+a[1]),$("[name='entime_"+e[i].weekday+"']").val(l[0]+":"+l[1]),a=null,l=null}if(null!=t){for(var s="",n="",o=0;o<t.length;o++)s="<tr><td>{1}</td><td>{2}</td><td>",n+=(s+="<input type='hidden' name='hdnblid' value='{3}'/><a title='delete' alt='delete' class='delete' onclick='livechatWSsettings.openDeleteIp(this);'><i class='fa fa-trash'></i></a></td></tr>").replace("{1}",t[o].ip_range_start).replace("{2}",t[o].ip_range_end).replace("{3}",o);$("#tblIpBanning tbody").append(n)}}catch(e){}},ChangeWidgetPreviewColors:function(e){r=parseInt(e.substr(1,2),16),g=parseInt(e.substr(3,2),16),b=parseInt(e.substr(5,2),16),hue=360*livechatWSsettings.rgbToHsl(r,g,b)[0],saturation=100*livechatWSsettings.rgbToHsl(r,g,b)[1];var t=(lightness=100*livechatWSsettings.rgbToHsl(r,g,b)[2])+10,i=lightness+10;lightness>80?($("#spnwebsitename,#spnbylinetext,.mtcolor,.mocolor,#aSend i,input[name=switch_3]~label").css("color","#333333"),$(".chatwindow .editor-paperclip i,.chatwindow .wdt-emoji-picker i").css("color","#333333")):($("#spnwebsitename,#spnbylinetext,.mtcolor,#aSend i,input[name=switch_3]~label").css("color","#ffffff"),$(".chatwindow .editor-paperclip i,.chatwindow .wdt-emoji-picker i").css("color",e)),$("#divhead1").css({"background-image":"linear-gradient(to bottom,"+e+" 0%, hsl("+hue+","+saturation+"%,"+t+"%) 100%)"}),$("#divhead1").css({"background-image":"-webkit-linear-gradient(bottom,"+e+" 0%, hsl("+hue+","+saturation+"%,"+t+"%) 100%)"}),$("#chatwindow").css("background-color","hsl("+hue+","+saturation+"%,98%)"),$(".widgetalerts").css("background-color","hsl("+hue+","+saturation+"%,98%)"),$(".widgetstarticon label").css("background",e),$(".mtcolor").css("background-color","hsl("+hue+","+saturation+"%,"+t+"%)"),$(".nitesh-chat-box").css("border-top-color","hsl("+hue+","+saturation+"%,"+t+"%)"),$("#start-chat").css("background-color","hsl("+hue+","+saturation+"%,"+i+"%)"),$("#start-chat").hover(function(){$("#start-chat").css("background-color",e)}).mouseout(function(){$("#start-chat").css("background-color","hsl("+hue+","+saturation+"%,"+i+"%)")}),$(".btn-togo").css("background-color","hsl("+hue+","+saturation+"%,"+t+"%)"),$("#aSend").css("background","hsl("+hue+","+saturation+"%,"+t+"%)"),$(".mocolor").css("background","hsl("+hue+","+saturation+"%,95%)")},saveWsWidgetVisibility:function(e){if(e.indexOf("Error")>=0||e.indexOf("ERROR")>=0){e.substring(6);UIToastr("error","unable to update the Widget Visibility settings")}else{if(e.indexOf("success")>=0||e.indexOf("SUCCESS")>=0)"1"==(e=e.substring(8))&&UIToastr("success","Widget Visibility settings saved successfully");else;}},openDeleteIp:function(e){try{var t=$($(e).parents("tr")).find("input[name='hdnblid']").val();$("#btnPopupBLSubmit").attr("onclick","livechatWSsettings.deleteIp("+t+");"),$("#modaldeleteip").modal("show")}catch(e){}},deleteIp:function(e){try{var t=$("#tblIpBanning tbody tr").find("input[value='"+e+"']").parents("tr");$(t).remove(),$("#modaldeleteip").modal("hide")}catch(e){}}};$(function(){if(!livechatWSsettings.validateSessionData())return!1;$("#tmplChannels a[data-toggle=tab]").on("click",function(e){if($(this).parent("li").hasClass("disabled"))return e.preventDefault(),!1}),lc_website_id=sessionStorage.getItem("LCWSID"),lc_rtm_id=sessionStorage.getItem("LCRTMID"),wsSettings.getWebsiteData(lc_website_id,lc_rtm_id,livechatWSsettings.bindWebSiteData);try{$("#chkwaittime").is(":checked")?$("input[name=setwaittime]").prop("disabled",!1):$("input[name=setwaittime]").prop("disabled",!0),AssignKeyupEvents(),livechatWSsettings.LogoUpload()}catch(e){}$("#btnSaveWSGensettings").click(function(){if(!livechatWSsettings.validateSessionData())return!1;livechatWSsettings.validateWsGeneralSettings()&&wsSettings.updateWebsiteGeneral(lc_website_id,lc_rtm_id,$("#txtwebsitename").val(),$("#txtbylinetxt").val(),$("#txtbaseurl").val(),$("#chkwaittime").is(":checked")?1:0,$('input[name="setwaittime"]:checked').val(),void 0==sessionStorage.getItem("LCWSID")?0:1,livechatWSsettings.saveWsGeneralSettings)}),$("#btnSaveWSapprncesettings").click(function(){if(!livechatWSsettings.validateSessionData())return!1;wsSettings.updateWebsiteAppearance(lc_website_id,lc_rtm_id,$("#txtWidgetColor").val(),$('input[name="switch_3"]:checked').val(),$("#chkenableemoji").is(":checked")?1:0,$("#hdnlogo").val(),livechatWSsettings.saveWsAppearenceSettings)}),$("#chkwrknghrs").click(function(){$("#chkwrknghrs").is(":checked")&&$("#myappvisibilitytiming").modal("show")}),$("#chkwaittime").change(function(){$(this).is(":checked")?$("input[name=setwaittime]").prop("disabled",!1):$("input[name=setwaittime]").prop("disabled",!0)}),$("#chkenableemoji").change(function(){$(this).is(":checked")?$(".icon-happy").css("display","block"):$(".icon-happy").css("display","none")}),$("#txtwebsitename").on("keyup keypress blur change",function(){$("#spnwebsitename").text($(this).val())}),$("#txtbylinetxt").on("keyup keypress blur change",function(){$("#spnbylinetext").text($(this).val())}),$("#divWidgetColor").on("changeColor.colorpicker",function(e,t,i){color=$(this).colorpicker("getValue"),livechatWSsettings.ChangeWidgetPreviewColors($(this).colorpicker("getValue"))}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).attr("href");"#general"==t?($(".imichatwidget-body").addClass("general-widget"),$(".imichatwidget-body").removeClass("widgetvisibility-widget customerqualification-widget appearance-widget")):"#appearance"==t?($(".imichatwidget-body").addClass("appearance-widget"),$(".imichatwidget-body").removeClass("general-widget customerqualification-widget widgetvisibility-widget")):"#widgetvisibility"==t?($(".imichatwidget-body").addClass("widgetvisibility-widget"),$(".imichatwidget-body").removeClass("general-widget customerqualification-widget appearance-widget")):"#customerqualification"==t&&($(".imichatwidget-body").addClass("customerqualification-widget"),$(".imichatwidget-body").removeClass("general-widget widgetvisibility-widget appearance-widget"))});try{$("#sttime_0,#sttime_1,#sttime_2,#sttime_3,#sttime_4,#sttime_5,#sttime_6").clockpicker({placement:"bottom",align:"left",autoclose:!0})}catch(e){}try{$("#entime_0,#entime_1,#entime_2,#entime_3,#entime_4,#entime_5,#entime_6").clockpicker({placement:"bottom",align:"left",autoclose:!0})}catch(e){}$("#sttime_0,#sttime_1,#sttime_2,#sttime_3,#sttime_4,#sttime_5,#sttime_6").on("blur",function(){$(this).clockpicker("hide")}),$("#entime_0,#entime_1,#entime_2,#entime_3,#entime_4,#entime_5,#entime_6").on("blur",function(){$(this).clockpicker("hide")}),$("#sttime_0,#sttime_1,#sttime_2,#sttime_3,#sttime_4,#sttime_5,#sttime_6").tooltip(),$("#entime_0,#entime_1,#entime_2,#entime_3,#entime_4,#entime_5,#entime_6").tooltip(),$("#btnSaveWSvisibilitySettings").click(function(){try{if(livechatWSsettings.SaveOfficeTimingsSettings()){var e=$("form[name=frmworkinghrs]").serialize(),t="";$("#tblIpBanning tbody tr").each(function(e,i){t+=$($(i).find("td")[0]).text()+"-"+$($(i).find("td")[1]).text()+","}),e+="&iprange="+t,wsSettings.updateWebsiteVisibility(lc_website_id,e,livechatWSsettings.saveWsWidgetVisibility)}}catch(e){}}),$("#btnaddip").click(function(){try{$(".ipban").val(""),wmsutil.destroyToolTip("#txtiprangestart"),wmsutil.destroyToolTip("#txtiprangeend"),$("#myappvipbanning").modal()}catch(e){}}),$("#btnIpRangeAdd").click(function(){try{if(""==$("#txtiprangestart").val().trim())return void wmsutil.showToolTip("#txtiprangestart","Please enter IP Range Start","top");if($("#txtiprangestart").val().length>0||""!=$("#txtiprangestart").val()){var e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;if(!/^[\d\-,.]+$/.test($("#txtiprangestart").val()))return void wmsutil.showToolTip("#txtiprangestart","Please enter Valid values","top");if(!e.test($("#txtiprangestart").val().trim()))return void wmsutil.showToolTip("#txtiprangestart","Invalid IP address","top")}if(""==$("#txtiprangeend").val().trim())return void wmsutil.showToolTip("#txtiprangeend","Please enter IP Range End","top");if($("#txtiprangeend").val().length>0||""!=$("#txtiprangeend").val()){e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;if(!/^[\d\-,.]+$/.test($("#txtiprangeend").val()))return void wmsutil.showToolTip("#txtiprangeend","Please enter Valid values","top");if(!e.test($("#txtiprangeend").val().trim()))return void wmsutil.showToolTip("#txtiprangeend","Invalid IP address","top")}var t=1;if($.each($("#tblIpBanning tbody tr"),function(e,i){return $($(i).find("td")[0]).text().trim()==$("#txtiprangestart").val().trim()?(wmsutil.showToolTip("#txtiprangestart","IP address already exists","bottom"),void(t=0)):$($(i).find("td")[0]).text().trim()==$("#txtiprangeend").val().trim()?(wmsutil.showToolTip("#txtiprangeend","IP address already exists","bottom"),void(t=0)):void 0}),1===t){var i="<tr><td>{1}</td><td>{2}</td><td>";i+="<input type='hidden' name='hdnblid' value='{3}'/><a title='delete' alt='delete' class='delete' onclick='livechatWSsettings.openDeleteIp(this);'><i class='fa fa-trash'></i></a></td></tr>";var a=0;try{$("#tblIpBanning tbody tr").length>1&&(a=$("#tblIpBanning tbody tr:last").find("input[name='hdnblid']").val())}catch(e){}a=parseInt(a)+1;var l=i.replace("{1}",$("#txtiprangestart").val().trim()).replace("{2}",$("#txtiprangeend").val().trim()).replace("{3}",a);$("#tblIpBanning tbody").append(l),$("#myappvipbanning").modal("hide")}}catch(e){}}),$("#chkselectall").change(function(){try{var e=this.checked;$(".workingday").each(function(){this.checked=e})}catch(e){}}),$(".workingday").change(function(){try{0==$(this).prop("checked")&&$("#chkselectall").prop("checked",!1),$(".workingday:checked").length==$(".workingday").length&&$("#chkselectall").prop("checked",!0)}catch(e){}})});