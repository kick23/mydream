$(function(){performanceReport.bindTeam(),$("#txtgrph_date_chatcnt").daterangepicker({startDate:moment().subtract(1,"months"),minDate:moment().subtract(12,"months"),maxDate:moment(),dateLimit:{month:3}}),$("#ddlTeam").change(function(){"select activity"!==$("#ancDuration").text().toLowerCase().trim()&&performanceReport.generateReport($("#dvGroupBy input:radio:checked").val())}),$("#dvGroupBy input:radio").not(":disabled").click(function(){performanceReport.generateReport($(this).val())}),$("#ulDuration li").click(function(){var e=$(this).val();switch($("#ancDuration").text($(this).text()),$("#ancDuration").attr("data-value",e),parseInt(e)){case 0:case 1:performanceReport.updateGroupByOptionSelectors(2,1,1),performanceReport.resetDatePicker();break;case 2:performanceReport.updateGroupByOptionSelectors(0,0,2,1),performanceReport.resetDatePicker();break;case 9999:return void $("#mdCusRange").modal()}performanceReport.generateReport($("#dvGroupBy input:radio:checked").val())}),$("#btnSubmitRange").click(function(){performanceReport.submitRange(),$("#ancDuration").text(moment($('#ulDuration li[value="9999"]').attr("data-date-start")).format("MMM/DD/YYYY")+" - "+moment($('#ulDuration li[value="9999"]').attr("data-date-end")).subtract(1,"day").format("MMM/DD/YYYY")),timeSpan=(new Date($('#ulDuration li[value="9999"]').attr("data-date-end"))-new Date($('#ulDuration li[value="9999"]').attr("data-date-start")))/6e4,timeSpan<=1440?performanceReport.updateGroupByOptionSelectors(2,1,1):timeSpan<10080?performanceReport.updateGroupByOptionSelectors(0,0,2):timeSpan<=43200?performanceReport.updateGroupByOptionSelectors(0,0,2,1):performanceReport.updateGroupByOptionSelectors(0,0,0,2),performanceReport.generateReport($("#dvGroupBy input:radio:checked").val())})});var performanceReport={updateGroupByOptionSelectors:function(e,t,a,r){$("#dvGroupBy div span").removeClass("input-checked"),performanceReport.updateGroupByRB(30,e),performanceReport.updateGroupByRB(60,t),performanceReport.updateGroupByRB(1440,a),performanceReport.updateGroupByRB(10080,r)},updateGroupByRB:function(e,t){var a=$('#dvGroupBy input[type="radio"][value="'+e+'"]');void 0!==t&&t>0?(a.is(":disabled")&&a.removeAttr("disabled"),2==t&&(a.parent().find("span").addClass("input-checked"),a.prop("checked",!0))):a.is(":disabled")||a.attr("disabled","disabled")},resetDatePicker:function(){var e=$("#txtgrph_date_chatcnt").data("daterangepicker");e.setStartDate(moment().subtract(1,"months")),e.setEndDate(moment())},getPerformanceData:function(e,t,a){var r=parseInt($("#ddlTeam option:selected").val()),n=performanceReport.getDateRange();IMIchat_Util.post("groupadmin","getperformancedata",function(e){console.log(e),a(e)},1,{teamid:r,startdate:n.startDate,enddate:n.endDate,interval:e,chartgroup:t,rangeoption:parseInt($("#ancDuration").attr("data-value"))})},getDateRange:function(){var e=new Object,t=new Date;switch(parseInt($("#ancDuration").attr("data-value"))){case 0:e.startDate=moment(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0)).format("LLLL"),e.endDate=moment(new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),0,2)).format("LLLL");break;case 1:var a=new Date(t.getTime()-864e5);e.startDate=moment(new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0)).format("LLLL"),e.endDate=moment(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0)).format("LLLL");break;case 2:var r=new Date(t.getTime()-6048e5);a=new Date(t.getTime()-864e5),e.startDate=moment(new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0)).format("LLLL"),e.endDate=moment(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0)).format("LLLL");break;case 9999:e.startDate=$('#ulDuration li[value="9999"]').attr("data-date-start"),e.endDate=$('#ulDuration li[value="9999"]').attr("data-date-end")}return e},validateMandatoryFields:function(){var e=0;return-1==$("#ddlTeam option:selected").val()&&(UIToastr("error","Please select Team."),e++),void 0===$("#ancDuration").attr("data-value")&&(UIToastr("error","Please select Duration."),e++),0===e},generateReport:function(e){performanceReport.validateMandatoryFields()&&($("#dvGroupBy").is(":visible")||($("#dvGroupBy").show(),$("#dvCharts").show()),$("#dvCharts div[data-name]").html(""),$(".highcharts-data-table").remove(),$("#dvCharts .loader").show(),performanceReport.getPerformanceData(e,1,function(e){var t=$.map(e,function(e){return e.Timestamp});$("#dvCharts div[data-name]").each(function(a,r){var n=$.map(e,function(e){return e[$("#"+r.id).attr("name")]});"chrtAvgHndlTime"!=r.id&&("chrtMaxWaitTime"==r.id||"chrtAvgRespTime"==r.id?IMIchat_Util.drawBasicChart(r.id,t,n,function(e,t){return{name:e,y:IMIchat_Util.getReadableTimespan(t)}}):IMIchat_Util.drawBasicChart(r.id,t,n))})}),performanceReport.getPerformanceData(e,2,function(e){var t=$.map(e,function(e){return e.Timestamp}),a=$.map(e,function(e){return e[$("#chrtAvgHndlTime").attr("name")]});IMIchat_Util.drawBasicChart("chrtAvgHndlTime",t,a,function(e,t){return{name:e,y:IMIchat_Util.getReadableTimespan(60*t)}})}))},submitRange:function(){var e=$("#txtgrph_date_chatcnt").data("daterangepicker");$('#ulDuration li[value="9999"]').attr("data-date-start",moment(e.startDate).format("LLLL")),$('#ulDuration li[value="9999"]').attr("data-date-end",moment(new Date(e.endDate._d.getFullYear(),e.endDate._d.getMonth(),e.endDate._d.getDate(),0,0,0,0)).add(1,"day").format("LLLL")),$("#mdCusRange").modal().hide()},bindTeam:function(){IMIchat_Util.post("groupadmin","getteams",function(e){try{var t=html="";if($("#ddlTeam").html(""),$("#ddlTeam").append("<option value=-1>Select Team</option>"),null!=e){for(var a=0;a<e.length;a++)t!=e[a].depname&&(""!=t&&(html+="</optgroup>"),t=e[a].depname,html=html+'<optgroup label="'+t+'">'),html=html+"<option value="+e[a].chatgrpid+">"+e[a].name+"</option>";$("#ddlTeam").append(html)}}catch(e){console.log(e.message)}$("#ddlTeam").chosen(),$("#ddlTeam").trigger("chosen:updated")})}};